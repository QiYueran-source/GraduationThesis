# 论文思路  


## 1.核心思路  
**使用不同的Agent模拟不同投资者，计算Agent投资者的预期协同度AED，检验AED的有效性**   

## 2.数据 
- 交易数据 
- 公司信息(行业，发行数等)  
- 财务报表  
- 市场信息(如指数，涨跌停等信息)   
- 宏观数据  
- 公司年报文本  
- 舆情数据   
- 机构持仓数据  

## 2.Agent分类  
- 机构投资者可以获得所有信息，设定为多个专业化agent，每个agent分析若干类数据，提供分析报告和收益预测；决策agent汇总信息进行决策  
- 散户投资者agent  
    - 技术流派，仅能获取交易信息，可以用交易信息构建技术指标   
    - 跟风者，根据机构持仓调整  
    - 价值投资者，获取交易信息和部分财务信息  
    - naive投资者，随机交易   
    等等  

agent根据输入信息，预测收益率  

## 3.agent的学习机制   
### 3.1 数据输入  
对于不同的agent，提供相应的数据  
```prompt 
f"""
你是一个技术型agent:  
rsi={rsi}, 关注度={rsi_attention};  
PE={pe}, 关注度={pe_attention};   
...  
请输出对于该证券的预期价格
"""
```
关注度可以是负数，表示与预期价格负相关     

**注意**：不应该为agent设定模型约束，比如使用线性模型或者非线性变换后的线性模型  
这样会导致模型复杂度退化，丧失了agent的复杂度  
类似让agent进行“主观多头”   

### 3.2 贝叶斯网络优化   
为了充分利用llm的能力，每次的分析需要总结为一个insight文本和attention数据，insight即agent的具体分析，而attention是各个指标的关注度(指标:关注度)   
attention可以通过多元线性回归系数来初始化，但不提供硬性的计算公式，而是将系数提供给llm，由其主观获取关注度  

在下一次训练时，需要加载这个insight文本和attention数据，以及具体的结果，使用llm来分析实际表现和预测的差异     
同样可以传入回归系数

### 3.3 注意机制优化  
基于关注度排序，优先处理关注度高的数据  

**注**，上述的回归需要基于非文本数据，对于文本数据，需要先使用agent编码为数字（如对于未来价格的可能贡献度，用softmax归一化）   

### 3.4 基于互学习的优化 (拓展) 
AED注重不同agent的预测价值区别，如果agent可以互相学习，那么可能可以降低AED，提高协同率  
具体的，机构agent可以学习散户的所有行为（信息充足）；散户只能学习机构的持仓（或者机构生成的分析报告）  


## 4.AED数据测试  
- 多空组合  
- 多因子FM回归  
- CAPM-alpha  


## 5.数据组织  
### 5.1 state设计  
参考ai-hedge-fund项目的AgentState设计，该类将提示词，查询方式和结果进行集成，方便使用和展示  

### 5.2 数据保存与获取  
使用PostgreSQL数据库保存金融数据，Redis作为数据总线，实现高效的滑动窗口查询  

### 5.3 训练  
数据集方面，剔除ST，金融，房地产等股票   
与基准论文类似，对每一只股票进行分析，得到分析结果   
为了提高效率，以batch的形式并行训练，需要对ollama或者外部api   


## 6.文献方向  
- 1.获取关于股市 预期协同 的论文    
- 2.如何构建用于投资的agent-prompt     
- 3.如何基于更高级的方法训练agent  
  

